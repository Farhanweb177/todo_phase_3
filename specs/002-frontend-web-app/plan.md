# Implementation Plan: Frontend Web Application

**Branch**: `002-frontend-web-app` | **Date**: 2026-02-07 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-frontend-web-app/spec.md`

**Note**: This plan outlines the technical architecture and implementation approach for building the Next.js frontend with authentication and full API integration.

## Summary

Build a responsive Next.js 16+ web application with TypeScript and Tailwind CSS that provides user authentication and complete task management functionality. The frontend will consume the existing FastAPI backend (specs/001-todo-web-app) via RESTful APIs with JWT-based authentication. Key features include user registration/sign-in, protected routes, task CRUD operations, status filtering, and responsive design for desktop and mobile devices.

## Technical Context

**Language/Version**: TypeScript 5.0+ with Next.js 16+
**Primary Dependencies**: React 19, Next.js 16 (App Router), Axios 1.7, Tailwind CSS, jwt-decode
**Storage**: LocalStorage for JWT tokens and user data (client-side)
**Testing**: Jest 29 with React Testing Library and ts-jest
**Target Platform**: Web browsers (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+), iOS Safari, Android Chrome
**Project Type**: Web application (frontend only, consumes existing backend API)
**Performance Goals**: <1s page load, <2s API operations, <500ms auth redirects, 95% operation success rate
**Constraints**: Requires stable network connection, no offline mode, single-device sessions, JWT tokens expire after configured time
**Scale/Scope**: Single frontend application with ~10-15 components, 5 routes, responsive design for desktop/tablet/mobile

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Constitutional Alignment

✅ **Spec-First Development**: This plan follows the approved specification in specs/002-frontend-web-app/spec.md with complete requirements and acceptance criteria.

✅ **No Manual Coding**: All implementation will be done via Claude Code agents following explicit task breakdowns.

✅ **Deterministic Behavior**: Frontend state management uses React Context with predictable state transitions. All API calls have defined request/response contracts.

✅ **Security by Design**:
- All protected routes require JWT authentication
- JWT tokens attached to all API requests via Authorization header
- 401 errors trigger automatic sign-out and redirect
- User ID derived from JWT token, never trusted from client input
- Input validation on client-side, with backend validation as authoritative

✅ **Production Realism**:
- Uses production-grade Next.js framework with App Router
- JWT-based authentication aligned with backend Better Auth implementation
- RESTful API consumption following industry standards
- Environment variables for configuration (NEXT_PUBLIC_BACKEND_URL)
- Responsive design for real-world device support

✅ **Separation of Concerns**:
- Clear boundary between frontend (Next.js) and backend (FastAPI)
- Communication only via documented REST APIs (specs/001-todo-web-app/contracts/openapi.yaml)
- Authentication state managed separately from UI state
- API client layer abstracted from components
- Service layer separates API logic from UI components

### Technical Constraints Compliance

✅ **Frontend**: Next.js 16+ with App Router ✓
✅ **API Style**: RESTful, JSON-only ✓
✅ **Auth Header**: Authorization: Bearer <JWT> ✓
✅ **Backend Integration**: Consumes existing FastAPI backend ✓

### Security Constraints Compliance

✅ **API Routes**: All task operations require valid JWT
✅ **Unauthorized Requests**: 401 responses handled with sign-out + redirect
✅ **User ID**: Derived from JWT token by backend, frontend sends token
✅ **Token Storage**: JWT stored securely, attached to all authenticated requests
✅ **Data Isolation**: Backend enforces per-user filtering, frontend displays only user's data

### No Constitutional Violations

No violations detected. This frontend application fully aligns with the project constitution.

## Project Structure

### Documentation (this feature)

```text
specs/002-frontend-web-app/
├── spec.md              # Feature specification (user stories, requirements)
├── plan.md              # This file (implementation plan)
├── research.md          # Phase 0: Technology decisions and rationale
├── data-model.md        # Phase 1: TypeScript types and interfaces
├── quickstart.md        # Phase 1: Setup and development guide
├── contracts/           # Phase 1: API client contracts
│   └── api-client-spec.md
└── tasks.md             # Phase 2: NOT created by /sp.plan (generated by /sp.tasks)
```

### Source Code (repository root)

```text
frontend/
├── src/
│   ├── app/                    # Next.js App Router (routes)
│   │   ├── layout.tsx          # Root layout with AuthProvider
│   │   ├── page.tsx            # Landing/home page
│   │   ├── auth/               # Public authentication routes
│   │   │   ├── signin/
│   │   │   │   └── page.tsx    # Sign-in page
│   │   │   └── register/
│   │   │       └── page.tsx    # Registration page
│   │   └── dashboard/          # Protected routes (authenticated users only)
│   │       ├── page.tsx        # Dashboard with task list
│   │       └── tasks/
│   │           └── [id]/
│   │               └── page.tsx  # Task detail/edit page
│   │
│   ├── components/             # Reusable React components
│   │   ├── AuthProvider.tsx    # Authentication context provider
│   │   ├── Navbar.tsx          # Navigation bar with auth awareness
│   │   ├── TaskList.tsx        # Task list display with filtering
│   │   ├── TaskForm.tsx        # Create/edit task form
│   │   ├── TaskItem.tsx        # Individual task display
│   │   └── ProtectedRoute.tsx  # HOC for route protection
│   │
│   ├── services/               # API client and service layer
│   │   ├── api.ts              # Axios instance with interceptors
│   │   ├── auth.ts             # Authentication service functions
│   │   └── tasks.ts            # Tasks service functions
│   │
│   ├── utils/                  # Utility functions and types
│   │   ├── types.ts            # TypeScript type definitions
│   │   ├── validation.ts       # Form validation utilities
│   │   └── storage.ts          # LocalStorage helper functions
│   │
│   └── __tests__/              # Test files
│       ├── components/
│       │   ├── TaskForm.test.tsx
│       │   ├── TaskList.test.tsx
│       │   └── TaskItem.test.tsx
│       └── services/
│           ├── auth.test.ts
│           └── tasks.test.ts
│
├── public/                     # Static assets (images, icons)
├── .env.local                  # Environment variables (not committed)
├── .env.example                # Environment variable template
├── next.config.js              # Next.js configuration
├── tailwind.config.ts          # Tailwind CSS configuration
├── tsconfig.json               # TypeScript configuration
├── jest.config.js              # Jest testing configuration
├── package.json                # Dependencies and scripts
└── README.md                   # Project documentation
```

**Structure Decision**:
Selected "Web application" structure with frontend-only focus. The frontend directory contains a complete Next.js application using the App Router pattern. This aligns with Next.js best practices and the constitution's separation of concerns principle. The backend already exists in the parent project (specs/001-todo-web-app), so this structure focuses solely on the frontend implementation.

## Complexity Tracking

> **No constitutional violations to justify**

This implementation maintains simplicity by:
- Using standard Next.js App Router patterns (no custom routing)
- React Context for state management (no Redux or complex state libraries)
- Controlled components for forms (no form libraries)
- Direct Axios HTTP client (no complex data fetching libraries initially)
- Standard TypeScript types (no complex type systems or code generation)

All technical choices align with the constitution's production realism while maintaining simplicity.

## Phase 0: Research Findings

**See**: [research.md](./research.md)

**Key Decisions**:
1. **Framework**: Next.js 16+ with App Router for modern React patterns and built-in routing
2. **Authentication**: Custom JWT client with localStorage storage (backend handles Better Auth)
3. **API Client**: Axios with interceptors for JWT attachment and error handling
4. **State Management**: React Context + Hooks for auth state and simple UI state
5. **Forms**: Controlled components with custom validation (no form libraries)
6. **Styling**: Tailwind CSS for utility-first responsive design
7. **Type Safety**: TypeScript for compile-time checking and better DX
8. **Testing**: Jest + React Testing Library for component and integration tests
9. **Route Protection**: Next.js middleware + client-side auth context checks
10. **Error Handling**: Centralized API client error handler with user-friendly messages

All decisions prioritize simplicity, production readiness, and constitutional compliance.

## Phase 1: Design Artifacts

### Data Model
**See**: [data-model.md](./data-model.md)

**Key TypeScript Interfaces**:
- `User`: User profile with id, email, firstName, lastName, timestamps
- `Task`: Todo item with id, title, description, status, userId, timestamps
- `AuthTokens`: JWT access/refresh tokens with expiration
- `AuthState`: Authentication state (isAuthenticated, user, loading, error)
- Request/Response types for all API endpoints
- Form state types and validation types

### API Client Contract
**See**: [contracts/api-client-spec.md](./contracts/api-client-spec.md)

**Authentication API**:
- `registerUser(data: RegisterRequest): Promise<User>`
- `loginUser(data: LoginRequest): Promise<LoginResponse>`
- `getCurrentUser(): Promise<User>`

**Tasks API**:
- `getTasks(filters?: TaskFilter): Promise<TasksResponse>`
- `getTaskById(id: string): Promise<Task>`
- `createTask(data: CreateTaskRequest): Promise<Task>`
- `updateTask(id: string, data: UpdateTaskRequest): Promise<Task>`
- `deleteTask(id: string): Promise<void>`
- `toggleTaskCompletion(id: string): Promise<Task>`

All functions use typed requests/responses and handle errors consistently.

### Quick Start Guide
**See**: [quickstart.md](./quickstart.md)

Comprehensive setup guide covering:
- Prerequisites and dependencies
- Project initialization
- Environment configuration
- Directory structure
- Step-by-step implementation workflow
- Testing strategy
- Common issues and solutions

## Implementation Phases

### Phase 1: Project Setup & Configuration
**Goal**: Initialize Next.js project with all required dependencies and configuration

**Key Tasks**:
- Initialize Next.js 16+ project with TypeScript and Tailwind CSS
- Install dependencies (Axios, jwt-decode, testing libraries)
- Configure environment variables (.env.local with NEXT_PUBLIC_BACKEND_URL)
- Set up TypeScript, Tailwind, and Next.js configurations
- Create project directory structure

**Deliverable**: Configured Next.js project ready for development

### Phase 2: Type Definitions & Utilities
**Goal**: Define all TypeScript types and utility functions

**Key Tasks**:
- Create type definitions (src/utils/types.ts)
- Implement validation utilities (src/utils/validation.ts)
- Implement storage utilities (src/utils/storage.ts)
- Define constants and enums

**Deliverable**: Complete type system and utilities ready for use

### Phase 3: API Client Layer
**Goal**: Implement centralized API client with all service functions

**Key Tasks**:
- Create Axios instance with base configuration (src/services/api.ts)
- Implement request interceptor for JWT attachment
- Implement response interceptor for error handling
- Create authentication service functions (src/services/auth.ts)
- Create tasks service functions (src/services/tasks.ts)

**Deliverable**: Fully functional API client ready for component integration

### Phase 4: Authentication Context
**Goal**: Implement authentication state management

**Key Tasks**:
- Create AuthProvider context component (src/components/AuthProvider.tsx)
- Implement auth state management (user, isAuthenticated, loading, error)
- Implement auth actions (login, register, logout, checkAuth)
- Handle JWT token storage and retrieval
- Implement automatic auth status checking on app load

**Deliverable**: Global authentication state accessible to all components

### Phase 5: Layout & Navigation
**Goal**: Implement root layout and navigation components

**Key Tasks**:
- Create root layout with AuthProvider (src/app/layout.tsx)
- Implement Navbar component with auth awareness (src/components/Navbar.tsx)
- Add sign-out functionality
- Implement responsive navigation for mobile

**Deliverable**: App shell with navigation ready for page content

### Phase 6: Authentication Pages
**Goal**: Implement sign-in and registration pages

**Key Tasks**:
- Create sign-in page (src/app/auth/signin/page.tsx)
- Create registration page (src/app/auth/register/page.tsx)
- Implement form validation
- Handle authentication errors
- Implement redirects to dashboard on success

**Deliverable**: Complete authentication flow (register → sign-in → dashboard)

### Phase 7: Dashboard & Task List
**Goal**: Implement main dashboard with task list display

**Key Tasks**:
- Create dashboard page (src/app/dashboard/page.tsx)
- Implement route protection (require authentication)
- Create TaskList component (src/components/TaskList.tsx)
- Create TaskItem component (src/components/TaskItem.tsx)
- Implement task filtering (all, pending, completed)
- Implement empty state handling

**Deliverable**: Functional dashboard displaying user's tasks

### Phase 8: Task CRUD Operations
**Goal**: Implement create, update, delete operations

**Key Tasks**:
- Create TaskForm component (src/components/TaskForm.tsx)
- Implement create task functionality
- Implement edit task functionality
- Implement delete task with confirmation
- Implement toggle completion
- Refresh task list after mutations

**Deliverable**: Complete task management functionality

### Phase 9: Task Detail Page
**Goal**: Implement individual task detail view

**Key Tasks**:
- Create task detail page (src/app/dashboard/tasks/[id]/page.tsx)
- Display full task information
- Integrate TaskForm for editing
- Add delete and toggle actions
- Handle navigation back to dashboard

**Deliverable**: Task detail view with edit/delete capabilities

### Phase 10: Landing Page
**Goal**: Implement home/landing page with auth-aware routing

**Key Tasks**:
- Create landing page (src/app/page.tsx)
- Display welcome message and app description
- Add links to sign-in and register
- Redirect to dashboard if already authenticated

**Deliverable**: Complete landing page with smart routing

### Phase 11: Error Handling & Loading States
**Goal**: Implement comprehensive error handling and loading UX

**Key Tasks**:
- Add loading states to all async operations
- Implement error boundaries for React errors
- Display user-friendly error messages
- Handle network errors gracefully
- Add loading spinners and skeleton screens

**Deliverable**: Robust error handling and smooth loading experience

### Phase 12: Responsive Design & Polish
**Goal**: Ensure responsive design and polish UI

**Key Tasks**:
- Implement responsive layouts with Tailwind CSS
- Test on desktop, tablet, and mobile viewports
- Add visual distinction for completed tasks
- Improve form UX (focus states, validation feedback)
- Add confirmation dialogs for destructive actions

**Deliverable**: Polished, responsive UI for all devices

### Phase 13: Testing
**Goal**: Implement comprehensive test coverage

**Key Tasks**:
- Write unit tests for components (TaskForm, TaskList, TaskItem)
- Write unit tests for services (auth, tasks)
- Write integration tests for authentication flow
- Write integration tests for task CRUD operations
- Test error handling and edge cases

**Deliverable**: Test suite with good coverage and passing tests

## Dependencies & Prerequisites

**External Dependencies**:
- Backend API running at configured endpoint (NEXT_PUBLIC_BACKEND_URL)
- Backend API contract matches specs/001-todo-web-app/contracts/openapi.yaml
- Backend implements Better Auth with JWT token generation
- Backend has CORS configured to allow frontend origin

**Internal Dependencies**:
- Phase dependencies are sequential (each phase builds on previous)
- Some tasks within phases can be parallelized (e.g., components)

## Testing Strategy

**Unit Tests**:
- Test components in isolation with mocked props
- Test service functions with mocked Axios
- Test validation functions with various inputs
- Test utility functions

**Integration Tests**:
- Test authentication flow (register → sign-in → dashboard → sign-out)
- Test task CRUD flow (create → edit → delete)
- Test route protection (unauthenticated → redirect)
- Test API error handling (401 → sign-out)

**Manual Testing**:
- Cross-browser testing (Chrome, Firefox, Safari, Edge)
- Responsive design testing (desktop, tablet, mobile)
- Accessibility testing (keyboard navigation, screen readers)
- Performance testing (page load times, API response times)

## Deployment Considerations

**Environment Variables**:
- `NEXT_PUBLIC_BACKEND_URL`: Backend API base URL (changes per environment)
- `NEXT_PUBLIC_ENV`: Environment identifier (development, staging, production)

**Build Process**:
1. Install dependencies: `npm install`
2. Run type checking: `npx tsc --noEmit`
3. Run linting: `npm run lint`
4. Run tests: `npm run test`
5. Build production bundle: `npm run build`
6. Start production server: `npm run start`

**Deployment Platforms**:
- Vercel (recommended for Next.js)
- Netlify
- AWS Amplify
- Self-hosted (Docker container)

**Production Checklist**:
- ✓ Environment variables configured for production backend
- ✓ HTTPS enabled for secure JWT transmission
- ✓ CORS configured on backend to allow production frontend origin
- ✓ Error tracking configured (e.g., Sentry)
- ✓ Analytics configured (e.g., Google Analytics, Plausible)
- ✓ Performance monitoring enabled
- ✓ Accessibility audit passed
- ✓ Security audit passed (no exposed secrets, proper JWT handling)

## Performance Optimization

**Bundle Size**:
- Tailwind CSS purging for minimal CSS bundle
- Next.js automatic code splitting by route
- Dynamic imports for heavy components
- Tree shaking for unused code elimination

**Runtime Performance**:
- React component memoization where beneficial
- Efficient re-renders with proper state management
- Debounced form inputs for better UX
- Optimized images with Next.js Image component

**Network Performance**:
- API response caching (future enhancement with SWR/React Query)
- Request deduplication
- Proper HTTP caching headers
- Gzip/Brotli compression

## Security Considerations

**JWT Token Handling**:
- Store in localStorage (consider httpOnly cookies for production)
- Never log tokens
- Clear tokens on sign-out and 401 errors
- Validate token expiration on client-side

**Input Validation**:
- Client-side validation for UX
- Rely on backend validation as authoritative
- Sanitize user inputs before display (React handles by default)

**CORS & CSP**:
- Backend must allow frontend origin
- Content Security Policy headers for XSS protection

**Dependencies**:
- Regular dependency updates
- Security audit with `npm audit`
- Use trusted packages with active maintenance

## Success Criteria Alignment

This plan ensures all success criteria from the specification are met:

- ✓ SC-001: Registration/sign-in <2 minutes (simple forms, fast API)
- ✓ SC-002: Dashboard loads <1 second (optimized bundle, efficient rendering)
- ✓ SC-003: Task creation <2 seconds (efficient API client)
- ✓ SC-004: Task update/delete <2 seconds (optimized mutations)
- ✓ SC-005: Cross-browser/device support (responsive Tailwind CSS)
- ✓ SC-006: 95% success rate (robust error handling)
- ✓ SC-007: Auth redirects <500ms (client-side routing)
- ✓ SC-008: Form validation (comprehensive validation utils)
- ✓ SC-009: Graceful error handling (centralized error handler)
- ✓ SC-010: Auth persistence (localStorage, React Context)

## Next Steps

After `/sp.plan` completion:
1. Run `/sp.tasks` to generate detailed task breakdown
2. Review and approve task list
3. Run `/sp.implement` to execute implementation
4. Test and validate each phase
5. Deploy to production

---

**Plan Status**: ✅ Complete
**Ready for**: `/sp.tasks` command to generate implementation tasks
